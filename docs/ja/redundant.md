# (上級者向け)冗長化
Webシステムを構築する場合、Webサーバーの冗長化を行うケースも多いです。  
Exmentで冗長化構成を行う場合の手順を記載します。

## はじめに
本ページでは、以下のような構成を構築します。  


### 冗長化する際に考慮すること
一般的に、シングル構成のWebシステムと比較し、以下の点を考慮する必要があります。

- **アップロードファイルを、Webサーバー以外の場所に配置する**  
画面からアップロードしたファイルを、Webサーバーに配置してしまうと、もう片方のWebサーバーから、そのファイルにアクセスできなくなってしまいます。  
そのため、Webサーバーとは別の場所にアップロードする必要があります。  
今回は、AWSのS3にファイルをアップロードします。  

- **セッション管理方法を変更する**  
Laravelの標準機能を使用する場合、セッション管理は、Webサーバーに配置するファイルを使用して、管理を行います。  
しかし冗長化を行った場合、もう片方のWebサーバーにアクセスがあった場合、セッションが存在しないことになってしまうため、ログイン状態が失われる問題が発生します。  
そのため、セッション管理方法を変更します。  
今回は、Redisを使用することにします。


## 構築方法
### Webサーバー構築
Webサーバーを、それぞれ構築します。  
基本的には、[通常のインストール方法](/ja/quick_start)でインストールを行えば問題ございませんが、以下の内容だけ、追加で行う必要があります。

#### 追加ライブラリのインストール
composerを実行し、以下のライブラリを、Webサーバーにインストールしてください。

~~~
# S3
composer require league/flysystem-aws-s3-v3

# Redis
composer require predis/predis
~~~

#### .envファイル修正
- .envファイルを開き、以下の設定値を追加・変更します。  

~~~
###ファイルアップロード管理
EXMENT_DRIVER_DEFAULT=s3 #Exmentでファイルアップロードを行う先。s3に設定
AWS_ACCESS_KEY_ID=XXXXXX #AWSのS3のアクセスキー
AWS_SECRET_ACCESS_KEY=XXXXXX #AWSのS3のシークレットキー
AWS_DEFAULT_REGION=ap-northeast-1 #AWSのS3のリージョン
AWS_BUCKET=XXXXXX #AWSのS3のバケット名

###セッション管理
SESSION_DRIVER=redis #redisに書き換え
REDIS_HOST=127.0.0.1 #redisのホスト名
REDIS_PASSWORD=XXXXXX #redisのパスワード
REDIS_PORT=6379 #redisのポート番号
~~~
