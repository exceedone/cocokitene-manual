# 通知・メール送信設定
特定の条件で、ユーザーや指定のメールアドレスにメールを送信することができます。  

**※この機能でメール送信を実行する場合、[メール設定](/ja/system_setting#システムメール設定)を行う必要があります。**


## 通知トリガーの種類
現在Exmentでは、以下の通知トリガーの種類があります。

### 時間の経過
データに登録している日付の、一定日付より前の日に近付いた場合に、通知が実行されます。  
例：契約更新日が「7/31」で、設定で「10日前に通知」の設定を行っていた場合に、「7/21」にメールを送信します。    
**※この機能を実行する場合、事前に、[タスクスケジュール](/ja/quickstart_more?id=タスクスケジュール)設定を行う必要があります。**

### データ新規作成・更新・共有・コメント
以下の条件に合致した場合に、通知が実行されます。更新情報をいち早くキャッチしたい場合にご利用ください。  

- データの新規作成時
- データの更新時
- データに対し、コメントが実施された時
- データに対し、ファイルが添付された時
- データが共有された時  
  
※初期設定の場合、データ更新などを行ったログインユーザー自身には、通知は行われません。設定を変更する場合、[設定値変更](/ja/config)の「通知対象がログインユーザーだった場合、通知をスキップする」の設定を行ってください。  
※大量の通知やメールが実施される可能性があるため、データインポート時には、通知は行われません。


### ボタン
データ詳細画面に、通知用のボタンが表示されるようになります。  
指定のユーザーやメールアドレスに、メッセージを送信します。  
また、保存済のファイルを添付することも可能です。

![通知](img/notify/notify_button1.png)  
![通知](img/notify/notify_button3.png)  

### ワークフロー実行
ワークフローが実行された際、データの作成者や次の実行ユーザーに対して通知を実行することができます。


### 公開フォーム データ登録完了時、エラー時
公開フォームで、一般ユーザーがデータを入力時、ならびにエラー発生時に、一般ユーザーもしくは管理者に通知を送信することができます。  
※公開フォームについては、[こちら](/ja/publicform)をご確認ください。



## 通知アクションの種類
現在Exmentでは、以下の通知アクションの種類があります。  
また、通知設定画面で、誰に、通知を行うかを選択する、「通知対象」を設定します。

### Eメール
特定のEメールアドレスに、メールを送信します。

#### 通知対象（必須）

- ##### システム管理者
システム管理者に、メールを送信します。

- ##### 権限のあるユーザー
対象のデータの権限のあるユーザーに、メールを送信します。

- ##### 作成ユーザー
対象のデータを作成したユーザーに、メールを送信します。

- ##### 指定のメールアドレス
入力したメールアドレスに、メールを送信します。メールアドレスは複数指定できます。

- ##### Eメール列
通知対象のデータに、カスタム列「Eメールアドレス」を含んでいた場合、そのEメールアドレスに、メールを送信します。

- ##### ユーザー列
通知対象のデータに、カスタム列「ユーザー」を含んでいた場合、そのユーザー列に設定されているユーザーに、メールを送信します。

- ##### 選択肢 (他のテーブルの値一覧から選択) 内の Eメールアドレス列
データのカスタムテーブルに、カスタム列「選択肢 (他のテーブルの値一覧から選択)」を含んでいて、その参照先のテーブルに、Eメールアドレス列を含んでいた場合、そのEメールアドレスに、メールを送信します。

- ##### 指定のユーザー
選択したユーザーに、通知を送信します。  
※そのテーブルに権限が存在するユーザーのみ、選択肢候補が表示されます。権限のないユーザーには通知できません。

- ##### 指定の組織
選択した組織に、通知を送信します。  
※そのテーブルに権限が存在する組織のみ、選択肢候補が表示されます。権限のない組織には通知できません。



### システム内アラート
対象のユーザーがログイン時、ページ右上の通知アイコンに、通知アラートが表示されます。 
![通知](img/notify/notify_navbar1.png)  

#### 通知対象（必須）

- ##### システム管理者
システム管理者に、通知を送信します。

- ##### 権限のあるユーザー
対象のデータの権限のあるユーザーに、通知を送信します。

- ##### 作成ユーザー
対象のデータを作成したユーザーに、通知を送信します。

- ##### ユーザー列
通知対象のデータに、カスタム列「ユーザー」を含んでいた場合、そのユーザーに、通知を送信します。

- ##### 指定のユーザー
選択したユーザーに、通知を送信します。  
※そのテーブルに権限が存在するユーザーのみ、選択肢候補が表示されます。権限のないユーザーには通知できません。

- ##### 指定の組織
選択した組織に、通知を送信します。  
※そのテーブルに権限が存在する組織のみ、選択肢候補が表示されます。権限のない組織には通知できません。


### Slack
Slackに通知を送信します。  
※通知を行うには、WebhookのURLが必要です。URLの取得方法は、[こちら](/ja/notify_webhook)をご参照ください。

#### メンション設定
設定により、Slackのメンションを追加することができます。メンションは、以下の設定があります。

- ##### 全体メンション
Slack通知に、全体のメンションを行う「@here」を追加します。

- ##### 個別メンション
Slack通知に、個別のメンションを追加します。  
メンションを行うための、SlackのユーザーIDは、別途設定を行う必要があります。  
Slack ID設定方法は、[Slack ID設定方法](notify_webhook#slack-id設定方法)をご確認ください。

#### メンション対象

- ##### システム管理者
システム管理者に、通知を送信します。

- ##### 権限のあるユーザー
対象のデータの権限のあるユーザーに、通知を送信します。

- ##### 作成ユーザー
対象のデータを作成したユーザーに、通知を送信します。

- ##### ユーザー列
通知対象のデータに、カスタム列「ユーザー」を含んでいた場合、そのユーザー列に設定されているSlack IDに、メンションを送信します。


### Microsoft Teams
Microsoft Teamsに通知を送信します。  
※通知を行うには、WebhookのURLが必要です。URLの取得方法は、[こちら](/ja/notify_webhook)をご参照ください。  
※Microsoft Teamsでは、メンションの追加はできません。




## 一覧画面表示
v4.2.0より、通知設定画面は変更しました。追加したい通知の方法によって、以下のように操作してください。

- 時間の経過、データ新規作成・更新・共有・コメント、ボタン  
→カスタムテーブルのテーブル詳細設定ダイアログより、通知設定ボタンをクリックしてください。
![通知](img/notify/notify_moved1.png)  

- ワークフロー  
→ワークフロー設定のStep3にて、設定を行ってください。
![通知](img/notify/notify_moved2.png)  


## 新規作成 
- 一覧画面右上の［新規］ボタンをクリックします。
  
- 通知新規作成画面が表示されるので、必要事項を入力していきます。  
※入力する内容は、下記項目をご参照ください。

- 設定した内容を保存するには［送信］ボタンをクリックしてください。通知設定が作成されます。

## 編集
- 該当する行の［編集］リンクをクリックしてください。  
編集画面に移行するので、設定の変更が行えます。  

![通知](img/notify/notify_edit.png)  

## 複製
- 該当する行の［複製］リンクをクリックしてください。
該当する行の設定値を複製したまま、新規作成画面に移行します。

![通知](img/notify/notify_copy.png)  

## 削除
列の削除を行いたい場合、該当する行の［削除］リンクをクリックしてください。  

![通知](img/notify/notify_delete.png)  

## 設定項目詳細
「通知名」と、通知を行うための条件「通知条件設定」、どのように通知を行うかの「通知アクション設定」を設定します。  

### 通知名設定
![通知](img/notify/notify_name.png)

#### 通知名(英数字)
- システムで使用する通知の名称です。  
プラグイン(トリガー)のトリガー条件で通知実行直前や通知実行後を設定する際などに使用します。
- 使用できるのは、半角英数字と記号の "-" と "_" です。
- 文字数は30文字以内で、他の通知で使用している通知名は使用できません。

#### 通知表示名
- 通知名の名前を表します。

### 通知条件設定

![通知](img/notify/notify_form1.png)  

#### 実施トリガー
通知を行う条件となる設定を選択します。設定の詳細は、上記の[通知の種類](#通知の種類)をご確認ください。

#### 対象ビュー
通知を行う条件を絞る為に、[条件ビュー](/ja/view.md?id=条件ビュー)を選択します。

### 通知条件設定(時間の経過)

#### 日付対象列
通知の判定を行う対象の、カスタム列を選択します。  
選択できるカスタム列の種類は、「日付」「日時」です。  
※選択したカスタムテーブルが、「日付」「日時」を含んでいない場合、選択肢は表示されません。

#### 通知日
通知を行う日付を入力してください。「0」と入力することで、当日に通知を行います。

#### 通知前後
通知を行うのが、登録している日付の「前」か「後」かを選択します。  
例：「通知日」が7、「通知前後」が「前」の場合、指定したフィールドの日付の7日前に通知実行

#### 通知時間
通知を実行する時間です。0～23で入力します。  
例：「6」と入力した場合、6:00に通知実行


### 通知条件設定(データ新規作成・更新・共有・コメント)

#### 通知条件設定
通知を行う条件を設定します。
![通知](img/notify/notify_saved.png)  


### 通知条件設定(ボタン)

#### ボタン表示名
画面に表示するボタンの名称を記入します。

### 通知条件設定(ワークフロー)

#### 実行後ステータス
通知を送信するステータスを選択してください。アクション実行後のステータスを参照します。※空の場合はすべてが対象となります。

#### 実施アクション
通知を送信するアクションを選択してください。※空の場合はすべてが対象となります。


### 通知アクション設定

通知を実施するアクションを選択します。複数選択可能です。  
アクションの詳細は、[通知アクションの種類](#通知アクションの種類)をご確認ください。

![通知](img/notify/notify_action1.png)  


### 通知テンプレート
送付する通知のテンプレートを選択します。テンプレートを新規作成する場合、事前に通知テンプレート画面にて、新規テンプレートを作成してください。  
通知テンプレートについて、詳細は[こちら](/ja/mail)をご参照ください。  
  
  
>  **ファイルを添付した通知を行う場合、[こちらの設定](/ja/notify_encript)を行うことにより、添付ファイルの暗号化が行われます。**


## 通知に時間がかかる場合
通知処理は、メール・WebHookに関わらず、非常に時間がかかります。  
上級者向け機能ですが、[通知の遅延実行](/ja/additional_queue)もございますので、ご確認ください。通知の終了を待たず、後続処理を実施します。


## 通知(時間の経過)のコマンド実施
コマンドラインを使用し、通知の実施トリガー「時間の経過」で設定している通知を、「通知時間」設定よらずに、任意のタイミングで手動で実行することもできます。  
以下のコマンドのいずれかを実行してください。  

~~~
# 通知ID指定
php artisan exment:notify 1

# notify_name(通知名(英数字))指定
php artisan exment:notify --name=task_limit_date_notify
~~~

  
