# カスタム列管理
カスタムテーブルが持つ列、「カスタム列」の設定を行います。  

## 設定画面
- カスタムテーブル一覧で、設定を行いたいテーブルにチェックを1つ入れ、右上の「テーブル詳細設定」をクリックします。  
![カスタム列画面](img/column/column_grid4.png)
- もしくは、メニューから設定を行いたいテーブルを選択した後、同様に右上の「テーブル詳細設定」をクリックします。  
※該当のテーブルをメニューに表示する設定があらかじめ必要です。  
![カスタム列画面](img/column/column_grid5.png)
- 表示されたテーブル詳細設定の画面で、カスタム列のアイコンをクリックします。
![カスタム列画面](img/column/column_grid6.png)

- これで、チェックしたカスタムテーブルがもつ、列の一覧を表示します。  
![カスタム列画面](img/column/column_grid3.png)

## 列の新規追加
- 「カスタム列設定」画面で、ページ右上の［新規］ボタンをクリックします。

- カスタム列の新規追加画面が表示されますので、必要事項を入力します。
![カスタム列画面](img/column/column_new1.png)

## 保存
設定を入力したら、［送信］をクリックしてください。

## 編集
列の編集を行いたい場合、該当する行の［編集］リンクをクリックしてください。  
![カスタム列画面](img/column/column_edit.png)

## 削除
列の削除を行いたい場合、該当する行の［削除］リンクをクリックしてください。  
![カスタム列画面](img/column/column_delete.png)
**<span style="color: red; ">※ただし、システムでインストールしている列は削除できません。</span>**


## 記入項目の詳細(共通)
- 列名(英数字)：システムで使用する列の名称です。英数字、または「-」「\_」で記入します。設定できるのは1度のみで、変更できません。  
**※以下の名前は使用できません。**  
id,suuid,parent_id,parent_type,created_at,updated_at,deleted_at,created_user,updated_user,deleted_user

### 列表示名
画面に表示する、列の名前です。

## 列種類
設定する列の種類です。この項目で登録した内容が、データ登録時のフォームに適用されます。

> カスタム列ごとの、システムの仕様詳細は、[カスタム列リファレンス](/ja/column_reference)をご確認ください。

#### 1行テキスト
1行テキスト(テキストボックス)です。  
![カスタムビュー画面](img/column/column_type1.png)
#### 複数行テキスト
複数行テキスト(テキストエリア)です。  
![カスタムビュー画面](img/column/column_type2.png)
#### テキストエディタ
テキストエディタを使用したデータ入力ができます。
![カスタムビュー画面](img/column/column_type3.png)
#### URL
URLが入力できるフォームになります。  
![カスタムビュー画面](img/column/column_type4.png)
#### メールアドレス
メールアドレスが入力できるフォームになります。  
![カスタムビュー画面](img/column/column_type5.png)
#### 整数
整数のみ入力できるフォームになります。また、データ登録時に、項目の左右に［＋］［－］ボタンを表示して、クリックで値を上下することができます。  
![カスタムビュー画面](img/column/column_type6.png)
#### 小数
小数のみ入力できるフォームになります。パーセント表示をYESにすることで、データ表示の際に%表示されます。  
![カスタムビュー画面](img/column/column_type7.png)
#### 通貨
通貨の入力ができるフォームになります。表示形式は４種類（￥・円・＄・€）から選ぶことができます。
![カスタムビュー画面](img/column/column_type8.png)
#### 日付
日付のフォームになります。データ登録時に、カレンダーから日付を変更することができます。  
![カスタムビュー画面](img/column/column_type9.png)
#### 時刻
時間のフォームになります。データ登録時に、時計から時刻を変更することができます。  
![カスタムビュー画面](img/column/column_type10.png)
#### 日付と時刻
日時のフォームになります。データ登録時に、カレンダーと時計から日時を変更することができます。  
![カスタムビュー画面](img/column/column_type11.png)
#### 選択肢
選択肢のフォームになります。値と見出しが同じ選択肢一覧になります。  
![カスタムビュー画面](img/column/column_type12.png)
#### 選択肢 (値・見出しを登録)
選択肢のフォームになります。値と見出しが異なる選択肢一覧になります。  
![カスタムビュー画面](img/column/column_type13.png)
#### 選択肢 (他のテーブルの値一覧から選択)
選択肢のフォームになります。選択肢が他のテーブルの項目となる、選択肢を作成します。  
![カスタムビュー画面](img/column/column_type14.png)
#### YES/NO
「YES」と「NO」を切り替えるスイッチを作成します。データ登録時、YESだと1、NOだと0と登録されます。  
![カスタムビュー画面](img/column/column_type15.png)
#### 2値の選択
2つの値を切り替えるスイッチを作成します。データ登録時の値も変更できます。  
![カスタムビュー画面](img/column/column_type16.png)
#### 自動採番
UUIDやランダム文字列などの値を、データ作成時に作成します。  
![カスタムビュー画面](img/column/column_type17.png)
#### 画像
画像をアップロードするフォームになります。  
![カスタムビュー画面](img/column/column_type18.png)
#### ファイル
ファイルをアップロードするフォームになります。  
![カスタムビュー画面](img/column/column_type19.png)
#### ユーザー
システムのユーザーを選択する選択肢になります。  
![カスタムビュー画面](img/column/column_type20.png)
#### 組織
システムの組織を選択する選択肢になります。  
![カスタムビュー画面](img/column/column_type21.png)

## 記入項目の詳細(共通)
- ##### 列名(英数字)
システムで使用する列の名称です。英数字、または「-」「_」で記入します。設定できるのは1度のみで、変更できません。  
**※以下の名前は使用できません。**  
id,suuid,parent_id,parent_type,created_at,updated_at,deleted_at,created_user,updated_user,deleted_user

- ##### 列表示名
画面に表示する、列の名前です。

- ##### 列種類
[列種類の一覧](#列種類)から、データ登録に使用する列を選択します。

- ##### 必須
そのフィールドが必須項目であるかどうかを選択します。YESにした場合、データ記入画面で必須項目となり、記入していなかった場合にエラーが表示されます。  

- ##### 検索インデックス
下記の「[検索インデックス](#検索インデックス-1)」をご参照ください。  

- ##### フリーワード検索対象
検索インデックスがYESの場合に表示されます。  
下記の「[フリーワード検索対象](/ja/column#フリーワード検索対象詳細)」をご参照ください。  

- ##### ユニーク(一意)
YESにした場合、データ登録の際に、他のデータと重複する値を登録することが出来なくなります。複数列の値による特定の組み合わせでの重複登録を防ぎたい場合には、[複合ユニークキー設定](/ja/table.md?id=複合ユニークキー設定)をご参照ください。  

- ##### 1度のみ入力
YESにした場合、新規登録時にのみデータ登録が可能な列にすることが出来ます。データ編集時には表示専用となります。

- ##### 初期値
フォーム項目に初期値として入力しておく値です。  

- ##### プレースホルダー
フォーム項目にプレースホルダーとして登録する文字列です。  

- ##### ヘルプ
フォーム項目の下に、情報として表示する内容です。

- ##### 表示順
カスタム列の一覧画面における表示順位を指定します。

- ##### 既定のフォーム・ビューに追加する
YESの場合、新規作成に伴って既定のフォーム・ビューに列を追加します。列の新規作成時にのみ設定可能です。更新時はそれぞれ[フォーム画面](/ja/form.md)・[ビュー画面](/ja/view.md)から変更してください。

- ##### 見出し列に追加する
作成するカスタム列を見出し列に追加することができます。  
※カスタム列の新規作成時にのみ表示される設定です。設定の更新時には[見出し表示列設定](/ja/table.md#見出し表示列設定)から変更してください。

## 記入項目の詳細説明(列種類別)
- ##### 最大文字数(1行テキスト,複数行テキスト)
フォーム項目で記入できる最大文字数です。オーバーした場合にエラーが発生します。  

- ##### 使用可能文字(1行テキスト)
チェックを入れた文字の種類は、フォーム項目で入力が可能になります。
全てにチェックを入れていない場合には、すべての文字の種類が入力可能になります。
![カスタム列画面](img/column/available_characters.png)

- ##### サジェスト入力(1行テキスト)
同じカスタム列に既に登録しているデータの値から、入力内容と合致している値を入力候補として表示します。
![カスタム列画面](img/column/suggest.png)

- ##### 正規表現(1行テキスト)
入力内容を、正規表現によるバリデーションを行うことができます。詳細は[正規表現](#正規表現)をご確認ください。

- ##### 最小値(整数、小数)
フォーム項目で記入できる値の最小値です。その値を下回って送信した場合に、エラーが発生します。未記入の場合、最小値のチェックは行いません。  

- ##### 最大値(整数、小数)
フォーム項目で記入できる値の最大値です。その値を上回って送信した場合に、エラーが発生します。未記入の場合、最大値のチェックは行いません。  

- ##### 計算式(整数、小数、通貨)
詳細は[こちら](#計算式)をご確認ください。

- ##### 選択肢(選択肢, 選択肢 (値・見出しを登録))
フォーム項目で候補として表示する、選択肢を登録します。改行区切りで、複数の候補を登録します。  
列種類で「選択肢 (値・見出しを登録)」を選択していた場合、カンマを列の区切りとして、1列目が値、2列目が見出しになります。  
![カスタム列画面](img/column/column_select_valtext1.png)
↓  
![カスタム列画面](img/column/column_select_valtext2.png)  
フォームでデータ保存時には、1列目の値がデータベースに保存されます。  

- ##### <span id="radio_buttom"> ラジオボタン・チェックボックス形式で表示（YES/NO、選択肢、選択肢 (値・見出しを登録)）</span>
<span style="text-decoration: underline">選択肢、選択肢 (値・見出しを登録)の列で複数選択がNOの場合</span>には、ラジオボタン形式でフォームに表示することができます。
![カスタム列画面](img/column/radio_buttons.png) 

<span style="text-decoration: underline">YES/NOの列</span>、または、<span style="text-decoration: underline">選択肢、選択肢 (値・見出しを登録)の列で複数選択がYESの場合</span>には、チェックボックス形式でフォームに表示することができます。
![カスタム列画面](img/column/checkbox.png)

- ##### 自由に入力可能にする(選択肢)
YESにすることで、列設定に登録されていない選択肢を自由入力して登録できるようになります。  

![カスタム列画面](img/column/free_input.gif)

>[ラジオボタン・チェックボックス形式で表示](/ja/column#radio_buttom)をYESにしている場合には、この設定は不可になります。

- ##### 初期値種類（日付、時刻、日付と時刻、ユーザー）
データを新規登録する時の、初期値の種類を設定することができます。  
・日付、時刻、日付と時刻の列では、［指定の日時］もしくは［データ入力実施の日時］が初期値として設定できます。  
・ユーザー列では、［指定のユーザー］もしくは［ログインユーザー］が初期値として設定できます。

- ##### 対象テーブル(選択肢 (他のテーブルの値一覧から選択))
フォーム項目で、選択肢の候補として表示するテーブルを指定します。  

>選択肢として一覧に表示される文言は、[見出し表示列設定](/ja/table#見出し表示列設定)で変更できます。

- ##### 選択肢を都度検索する(選択肢 (他のテーブルの値一覧から選択)、ユーザー、組織）
通常、データ編集画面の選択肢は、画面読み込み時に、すべての候補を一覧表示します。  

![カスタム列画面](img/column/select_table_1.png)

この設定をYESにすることで、はじめは選択肢を読み込まず、ユーザーの入力値でデータを検索し、候補を絞り込みます。  

![カスタム列画面](img/column/select_table_2.png)

入力フォームに、文字列を入力することで、サーバーでデータ検索を行い、結果を候補表示します。

![カスタム列画面](img/column/select_table_3.png)

> この設定に関わらず、データの総件数が100件以上の場合は、パフォーマンス向上のために、絞り込みを行う設定になります。  
なお、この上限値は、[設定値](/ja/config#カスタムデータ)により変更できます。  


- ##### 採番種類（自動採番）
データ登録時に、採番を行う種類を選択します。
- <span class="heading_smaller_than_h5">フォーマット</span>  
ユーザーが指定したフォーマットで採番を登録します。
- <span class="heading_smaller_than_h5">ランダム(ライセンスコード)  </span>  
5文字×5で25文字のランダム文字列を登録します。
- <span class="heading_smaller_than_h5">ランダム(UUID)</span>  
合計32桁のランダム文字列を登録します。

- ##### 桁数(自動採番)
自動採番時に、データとして登録する桁数になります。不足分は0埋めで登録します。  

- ##### 権限をもたないユーザー・組織も表示する(ユーザー・組織)
テーブルへのアクセス権限をもつユーザー・組織のみを表示するか、全てのユーザー・組織を表示するかを設定します。

- ##### 複数選択を許可する
画像やファイル、選択肢系の項目で、複数の選択肢を行う場合にYESにしてください。  

## 自動採番フォーマットのルール
列種類を「自動採番」、採番種類（自動採番）を「フォーマット」にした場合、ユーザー独自のルールで、自動採番を登録することが出来ます。  

設定できるパラメータ変数は、以下のページをご確認ください。  
[パラメータ変数](/ja/params)

## 検索インデックス
「検索インデックス」とは、データの検索のパフォーマンスを向上させるために、あらかじめデータベースに設定しておく機能です。「インデックス」は「索引」ともいいます。  
Exmentでは、この検索インデックスをYESにした場合のみ、一部の機能が有効になります。
![検索インデックス](img/column/column_index.png)    

YESにした場合、以下の機能が有効になります。  
- [カスタムビュー](/ja/view)の「表示条件」設定で、「対象列」に表示される  
![カスタムビュー_表示条件](img/column/custom_view_filter.png)    

- [カスタムビュー](/ja/view)の「並べ替え」設定で、「対象列」に表示される  
![カスタムビュー_並べ替え](img/column/custom_view_sort.png)    

- [データ一覧](/ja/data_grid)の「フィルタ」設定の項目に表示される  
![データ_フィルタ](img/column/data_filter.png)    

- [データ一覧](/ja/data_grid)の「ソート」を行うアイコンが表示される
![データ_ソート](img/column/data_sort.png)    

- ページ上部の検索バーで、ユーザーがワードを記入した時、データ検索の検索対象となる。各種コードや各種名称など、検索画面で検索させたい列の場合、YESとしてください。  

- **<span id ="フリーワード検索対象詳細">フリーワード検索対象**</span>を設定することができます。  
YESにすることで、検索バーに文字列を入れて検索を行う際に、検索対象となります。

※同一のテーブルで、「検索インデックス」を非常に多く設定すると、データの新規作成時や更新時に、パフォーマンスが低下する可能性があります。  
同一のテーブルで設定できる「検索インデックス」は、推奨10件まで、最大20件までです。  
※なお、検索インデックスの上限値は、[設定値](/ja/config#検索インデックス件数)で変更できます。


## ラベルで使用する
> 本設定方法は、v1.3.0にて[カスタムテーブルの拡張設定](/ja/table#見出し表示列設定)に変更されました。

## 正規表現
> この設定は、[エキスパートモード](/ja/additional_expert)を有効にしていた場合のみ表示されます。

カスタム列種類が「1行テキスト」の場合、正規表現によるバリデーションを行うことができます。  

![正規表現](img/column/column_regex1.png)  

#### 正規表現の例
~~~
# 電話番号  
^0\d{2,3}-\d{1,4}-\d{4}$

# 郵便番号  
^\d{3}-\d{4}$

# ひらがなのみ
^[ぁ-ん]+$

# カタカナのみ
^[ァ-ヴ]+$
~~~


#### その他
- 正規表現を設定していた場合、「使用可能文字」は無効になります。  
- 正規表現の判定は、PHPの関数を使用しております。正規表現のサンプルを検索される場合、PHPの正規表現をベースに検索を行ってください。  
- 文頭と文末に付ける「/」や、文末の「u」は不要です。  
- 正規表現の内容については、お問い合わせの対象外になります。ご了承ください。



## 計算式
カスタム列種類が「整数」「小数」「通貨」の場合、計算式を設定することができます。  
データ入力画面で項目を入力時に、設定した計算式を用いて、自動的に計算されます。  

### 設定方法
- カスタム列種類が「整数」「小数」「通貨」の場合、「計算式」項目が表示されるので、クリックします。  
![検索インデックス](img/column/calc1.png)    

- 計算式用のダイアログが表示されます。  
![検索インデックス](img/column/calc2.png)  

- 計算式を入力してください。式は、右列のボタンをクリックして入力したり、手入力を行ってください。
※入力できる変数は、後述します。
![検索インデックス](img/column/calc3.png)  

- 入力が完了したら、「式の検証」ボタンをクリックし、入力を確定させてください。
![検索インデックス](img/column/calc4.png)  

- ※入力した式に何かしらの誤りがあると、エラーが表示され、設定できません。
![検索インデックス](img/column/calc5.png)  

- 正常な式を入力後、「設定」ボタンをクリックすることで、ダイアログが閉じられ、式が設定されます。
![検索インデックス](img/column/calc6.png)  

- 設定後、データ入力画面で、計算式が実行されます。(以下例は、列3に、列1 × 列2 を設定)
![検索インデックス](img/column/calc7.gif)  


### 使用できる式・変数

#### 通常の演算子
- +, -, *, /  
※半角で入力してください。掛け算が"×"、割り算が"÷"でないことにご注意ください。

- カッコ()


#### 変数
※基本的に、「計算式」ダイアログの右列に設定されているボタンから、登録することをオススメします。

- 別の列の値
- 参照先のテーブルの列値
- 親テーブルの列値
- 子テーブルの列の合計値
- 子テーブルの件数


| 項目 | 例 | 説明 |
| ---- | ---- | ---- |
| ${value:(列名)} | ${value:mitsumori_zeigaku} | 同一テーブル内の、他の値が設定されます。<br />(例：見積明細テーブルに対し、見積額${value:mitsumori_zeigaku}と記入した場合、項目「見積額」に入力されている値が設定される)  |
| ${select_table:(列名).(参照先のテーブルの列名) | ${select_table:client.client_shikiri} | 同一テーブル内の、列種類「他のテーブルの値一覧から選択」「ユーザー」「組織」の場合、参照先の列の値が設定されます。<br />(例：「契約情報(contract)」テーブルに「顧客(client)」列があり、「顧客情報(client)」テーブルを参照している場合、${select_table:client.client_shikiri}と設定すれば、「顧客情報(client)」テーブルの顧客仕切値(client_shikiri)に入力されている値が設定される)  |
| ${parent:(列名)} | ${parent:mitsumori_value} | 親テーブルの、他の値が設定されます。<br />(例：見積テーブルと見積明細テーブルが1:nリレーションで、見積明細テーブルの列に対し、親テーブル列の見積額${parent:mitsumori_value}と記入した場合、親データ「見積額」に入力されている、列「見積額」の値が設定される)  |
| ${sum:(子テーブル名).(子テーブルの列名)} | ${sum:mitsumori_detail.mitsumori_zeigaku} | 1:nリレーションが行われており、親子データを同時に入力するフォームの場合、子テーブルの、指定の列の値の合計値が設定されます。<br />(例：見積テーブルと見積明細テーブルが1:nリレーションで、見積テーブルの列に対し、子テーブル列の見積明細額${sum:mitsumori_detail:mitsumori_zeigaku}と記入した場合、子データ「見積額」の、全データの合計で入力されている値が設定される)  |
| ${count:(子テーブル名)} | ${count:mitsumori_detail} | 1:nリレーションが行われており、親子データを同時に入力するフォームの場合、子テーブルの件数が設定されます。<br />(例：見積テーブルと見積明細テーブルが1:nリレーションの場合、子テーブルの件数が設定される)  |



### 循環式になった場合
以下のような設定を行うと、計算式が無限に発生してしまいます。    

- 列calc1：計算式「${value:calc2} + 2」
- 列calc2：計算式「${value:calc1} + 2」

「列calc1の値を入れる」→「列calc2の値に、calc1の値 + 2を入れる」→「列calc1の値に、calc2の値 + 2を入れる」→「列calc2の値に、calc1の値 + 2を入れる」...となり、計算が完了しません。  

このような計算式を設定時に、データ入力画面で値を入力すると、このようなアラートが表示されます。  
この場合、計算式設定を見直してください。
![検索インデックス](img/column/calc8.png)  


### 0除算が発生した場合
計算式によっては、0除算が発生する場合があります。  
その場合は、結果の項目には空欄がセットされます。


### その他
計算式ロジックは、画面でのデータ入力時に対応しております。  
現在、APIやプラグインといった機能でのデータ登録では対応しておりません。ご了承ください。